# A-Chat アプリケーション構築 TODO リスト

## プロジェクト概要
Next.js + Hono + Mastra + Claude APIを使用したリアルタイムチャットアプリケーション

---

## フェーズ1: プロジェクト初期化とセットアップ

- [x] Gitリポジトリの初期化
  - [x] `git init`
  - [x] `.gitignore` ファイルの作成
  - [x] 初期コミット

- [x] Next.jsプロジェクトのセットアップ
  - [x] `npx create-next-app@latest` の実行
  - [x] TypeScript設定の確認・調整
  - [x] App Routerの有効化確認

- [x] 依存関係のインストール
  - [x] Next.js関連パッケージ
  - [x] Hono (`hono`)
  - [x] Prisma (`prisma`, `@prisma/client`)
  - [x] Mastra (`@mastra/core` など)
  - [x] Anthropic Claude SDK (`@ai-sdk/anthropic`)
  - [x] MongoDB用ドライバー
  - [x] その他必要なユーティリティ（zod, ai など）

- [x] 開発環境の設定
  - [x] `.env.example` ファイルの作成
  - [x] 環境変数の定義（ANTHROPIC_API_KEY, MONGODB_URLなど）
  - [x] `tsconfig.json` の最適化
  - [x] ESLint/Prettier の設定

---

## フェーズ2: データベース設計と実装

- [x] Prismaのセットアップ
  - [x] `npx prisma init` の実行
  - [x] MongoDB接続設定

- [x] スキーマ設計
  - [x] `prisma/schema.prisma` の作成
  - [x] Sessionモデルの定義（id, createdAt, expiresAtなど）
  - [x] Messageモデルの定義（id, sessionId, role, content, timestampなど）

- [x] マイグレーション
  - [x] Prisma Clientの生成
  - [x] データベーススキーマの準備完了

- [x] データベース操作関数の作成
  - [x] セッション作成・取得・削除
  - [x] メッセージ保存・取得
  - [x] セッション有効期限管理

---

## フェーズ3: バックエンドAPI実装（Hono）

- [x] Honoサーバーのセットアップ
  - [x] `app/api/[[...route]]/route.ts` でHonoをマウント
  - [x] CORS設定

- [x] APIエンドポイントの実装
  - [x] `POST /api/sessions` - 新規セッション作成
  - [x] `GET /api/sessions/:id` - セッション取得
  - [x] `POST /api/chat` - チャットメッセージ送信（Phase 4でAI統合予定）
  - [x] `GET /api/messages/:sessionId` - メッセージ履歴取得
  - [x] エラーハンドリングミドルウェア

- [x] セッション管理ロジック
  - [x] データベースベースのセッション管理（Phase 2で実装済み）
  - [x] セッションタイムアウト処理
  - [x] セッションクリーンアップ処理

---

## フェーズ4: AI統合（Mastra + Claude API）

- [ ] Mastraエージェントの設定
  - [ ] Mastraの初期化コード作成
  - [ ] Claude APIとの連携設定

- [ ] チャット機能の実装
  - [ ] ユーザーメッセージの受信処理
  - [ ] Claude API（claude-4-sonnet）への送信
  - [ ] ストリーミングレスポンスの処理
  - [ ] 会話履歴のコンテキスト管理

- [ ] プロンプトエンジニアリング
  - [ ] システムプロンプトの設計
  - [ ] 会話の自然な流れを保つための設定

---

## フェーズ5: フロントエンド実装

### 5.1 基本構造

- [ ] レイアウトコンポーネント
  - [ ] `app/layout.tsx` の実装
  - [ ] レスポンシブデザインの基盤作成
  - [ ] グローバルスタイル設定

- [ ] ページ構成
  - [ ] `app/page.tsx` - メインチャットページ
  - [ ] エラーページ（`error.tsx`, `not-found.tsx`）

### 5.2 UIコンポーネント

- [ ] チャットインターフェース
  - [ ] `components/ChatContainer.tsx` - チャット全体のコンテナ
  - [ ] `components/MessageList.tsx` - メッセージ一覧表示
  - [ ] `components/Message.tsx` - 個別メッセージコンポーネント
  - [ ] `components/MessageInput.tsx` - メッセージ入力フォーム
  - [ ] `components/TypingIndicator.tsx` - 入力中インジケーター

- [ ] UIスタイリング
  - [ ] ビジネスライクなデザインの実装
  - [ ] モバイル対応（レスポンシブ）
  - [ ] アクセシビリティ対応

### 5.3 状態管理とAPI連携

- [ ] クライアント側の状態管理
  - [ ] セッション状態の管理
  - [ ] メッセージ履歴の管理
  - [ ] ローディング状態の管理

- [ ] API連携
  - [ ] セッション作成APIの呼び出し
  - [ ] チャットAPIの呼び出し
  - [ ] ストリーミングレスポンスの受信処理
  - [ ] エラーハンドリング

---

## フェーズ6: テスト実装

- [ ] テストフレームワークのセットアップ
  - [ ] Jest + React Testing Libraryのインストール
  - [ ] テスト設定ファイルの作成

- [ ] ユニットテスト
  - [ ] データベース操作関数のテスト
  - [ ] API エンドポイントのテスト
  - [ ] Reactコンポーネントのテスト

- [ ] 統合テスト
  - [ ] チャットフロー全体のテスト
  - [ ] セッション管理のテスト

- [ ] E2Eテスト（オプション）
  - [ ] Playwrightのセットアップ
  - [ ] 主要ユーザーフローのテスト

---

## フェーズ7: デプロイメント準備

- [ ] 環境設定
  - [ ] 本番環境用の環境変数設定
  - [ ] MongoDB Atlas等のクラウドDBセットアップ

- [ ] ビルド最適化
  - [ ] `next.config.js` の最適化
  - [ ] 不要なパッケージの削除
  - [ ] バンドルサイズの確認

- [ ] GCP Cloud Runデプロイ設定
  - [ ] `Dockerfile` の作成
  - [ ] `.dockerignore` の作成
  - [ ] Cloud Run用の設定ファイル
  - [ ] ビルド・デプロイスクリプト

- [ ] デプロイメント
  - [ ] イメージのビルド
  - [ ] Cloud Runへのデプロイ
  - [ ] デプロイ後の動作確認

---

## フェーズ8: ドキュメント作成

- [ ] README.md の作成
  - [ ] プロジェクト概要
  - [ ] セットアップ手順
  - [ ] 開発方法
  - [ ] デプロイ方法

- [ ] API ドキュメント
  - [ ] エンドポイント一覧
  - [ ] リクエスト/レスポンス形式

- [ ] アーキテクチャドキュメント
  - [ ] システム構成図
  - [ ] データフロー図

---

## 追加タスク・改善項目

- [ ] パフォーマンス最適化
  - [ ] レスポンスタイムの測定
  - [ ] キャッシング戦略の実装

- [ ] セキュリティ強化
  - [ ] レート制限の実装
  - [ ]入力バリデーションの強化
  - [ ] XSS/CSRF対策の確認

- [ ] モニタリング・ログ
  - [ ] エラーログの実装
  - [ ] アクセスログの実装
  - [ ] パフォーマンスモニタリング

---

## 優先度の高いタスク

1. フェーズ1: プロジェクト初期化
2. フェーズ2: データベース設計
3. フェーズ4: AI統合（コア機能）
4. フェーズ3: バックエンドAPI
5. フェーズ5: フロントエンド
6. フェーズ6: テスト
7. フェーズ7: デプロイ
8. フェーズ8: ドキュメント

---

## 備考

- 各フェーズは独立性を保ちつつ、必要に応じて並行作業可能
- テストは各実装フェーズと並行して進めることを推奨
- ユーザーフィードバックを受けて優先順位を調整
